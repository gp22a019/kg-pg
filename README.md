# KG Search for Wikidata - 改良版

## プロジェクト概要
- **名前**: KG Search for Wikidata - 改良版
- **目標**: Wikidataを使った軽量で使いやすい知識グラフ検索システム
- **特徴**: 
  - オリジナルKG Searchの手法を踏襲した2段階検索プロセス
  - 日本語ラベル優先表示
  - Googleライクなインターフェース
  - インライン詳細展開機能
  - テーブル形式の検索結果表示

## URL
- **デモ**: https://3000-iruruj8ba0oio6yfpqe5a-6532622b.e2b.dev
- **GitHub**: (設定予定)

## 新機能デモ
1. **詳細検索機能**: メインページ「詳細検索」リンク → 高度な検索条件設定
2. **プロパティ検索**: プロパティID「P31」+ 値「Q3918」→ 大学のみを検索
3. **検索タイプ**: 「大学」で前方一致検索 → 「大学*」で検索実行
4. **SPARQLクエリ表示**: 「クエリ表示」ボタン → 実行されるSPARQLクエリを確認・コピー
5. **関連度順序改善**: 「アインシュタイン」で検索 → アルベルト・アインシュタインが最上位に表示
6. **改良されたプロパティ表示**: 「東京大学」で検索 → 詳細表示 → 「所在地 (P131)」「維持機関 (P126)」等の改良されたラベル
7. **フル情報インライン展開**: 「大阪電気通信大学」→「寝屋川市」クリック → 画像・全プロパティを含む完全な詳細情報をその場表示
8. **画像表示機能**: 画像URLを自動検出してインライン画像表示（ホバー効果・クリック拡大機能付き）
8. **UI/UX改善**: 視覚的に区別されたプロパティセル、ホバー効果、アニメーション

## 完成した機能
✅ **基本検索機能**
- Wikimedia API + SPARQLクエリによる2段階検索
- 日本語/英語言語選択対応
- 検索結果のページネーション（20件ずつ追加読み込み）

✅ **フロントエンド機能**  
- Googleライクな検索インターフェース
- レスポンシブデザイン（TailwindCSS）
- 検索結果のテーブル表示（QID、ラベル、詳細列）
- ローディングアニメーション

✅ **詳細情報機能**
- テーブル内インライン展開
- エンティティプロパティの日本語表示
- 画像・リンク・データの適切な表示形式
- プロパティの日本語ラベルマッピング

✅ **インライン展開機能**
- Wikidataエンティティリンクのその場展開
- ページ遷移なしでの関連情報表示
- **フル情報表示**: 画像、全プロパティを含む完全な詳細情報
- アニメーション付きスムーズ展開
- 外部URLとエンティティリンクの自動区別
- スクロール可能なコンパクト表示（最大500px）

✅ **画像表示機能（NEW）**
- **画像自動検出**: WikimediaCommons、一般的画像拡張子の自動判定
- **インライン画像表示**: URLテキストリンクの代わりに実際の画像を表示
- **ホバー効果**: 画像に軽微な拡大とシャドウ効果
- **クリック拡大機能**: 画像クリックでモーダル表示（ESCキーで閉じる）
- **エラーハンドリング**: 読み込み失敗時の代替表示とリンク
- **パフォーマンス最適化**: 最大160x128pxのサムネイル表示

✅ **UI/UX改善（NEW）**
- **改良されたプロパティ表示**: 「日本語ラベル (PID)」形式
- **視覚的境界の明確化**: プロパティとバリューの区別
- **洗練されたデザイン**: グラデーション、シャドウ、アイコン
- **ホバー効果**: インタラクティブなユーザー体験
- **レスポンシブ対応**: モバイル環境での最適表示

✅ **API機能**
- `/api/search` - エンティティ検索（オリジナルKG Search方式）
- `/api/entity/:id` - エンティティ詳細取得
- `/api/advanced-search` - 詳細検索（NEW）

✅ **詳細検索機能（NEW）**
- **詳細検索ページ**: `/advanced` - 高度な検索条件設定
- **検索タイプ**: あいまい検索、前方一致、完全一致、部分一致
- **エンティティフィルター**: 人物、組織、大学、都市、国、本、映画
- **プロパティ検索**: P31=Q3918（分類=大学）等の高度検索
- **SPARQLクエリ表示**: 実行されるクエリの表示・コピー機能
- **多言語対応**: 日本語、英語、中国語、韓国語

## 機能URI一覧
- **メインページ**: `/` - 簡単検索インターフェース
- **詳細検索ページ**: `/advanced` - 高度な検索条件設定
- **検索API**: `/api/search?q={query}&lang={ja|en}&limit={数}&offset={数}`
  - 例: `/api/search?q=アインシュタイン&lang=ja&limit=5`
- **詳細検索API**: `/api/advanced-search?q={query}&type={fuzzy|prefix|exact|contains}&lang={ja|en|zh|ko}&entity_type={QID}&limit={数}&show_query={true|false}`
  - 例: `/api/advanced-search?q=大学&type=fuzzy&lang=ja&entity_type=Q3918&limit=10`
- **プロパティ検索**: `/api/advanced-search?property_id={PID}&property_value={value}&lang={ja|en}`
  - 例: `/api/advanced-search?property_id=P31&property_value=Q3918&lang=ja`
- **詳細API**: `/api/entity/{QID}?lang={ja|en}`
  - 例: `/api/entity/Q937?lang=ja`
- **静的ファイル**: `/static/app.js`, `/static/style.css`

## データアーキテクチャ
- **データモデル**: Wikidata エンティティ（QID）+ プロパティ + 値
- **検索プロセス**: 
  1. Wikimedia wbsearchentities API → エンティティID収集
  2. SPARQL クエリ（VALUES句使用）→ 詳細情報取得
- **ストレージサービス**: なし（完全にステートレス）
- **データフロー**: 
  ```
  ユーザー入力 → Wikimedia API → エンティティID → SPARQL → 結果表示
                                                    ↓
                            詳細クリック → SPARQL詳細クエリ → インライン展開
  ```

## 使用方法
1. トップページで検索キーワードを入力
2. 言語を選択（日本語/英語）
3. 「Wikidata検索」ボタンをクリック
4. 検索結果のテーブルで「詳細」ボタンをクリックして詳細情報を展開
5. **NEW**: 詳細情報内のエンティティリンク（🔍アイコン付き）をクリックでインライン展開
6. **NEW**: 画像をクリックしてモーダル表示で拡大、ホバーで軽微な拡大効果
7. 「さらに読み込む」で追加結果を取得

### 画像表示デモ手順
1. 「大阪電気通信大学」で検索 
2. 「詳細」ボタンをクリック → 大学の画像がインライン表示されます
3. 「寝屋川市」リンクをクリック → 市の建物や地図画像がインライン表示されます  
4. 画像にマウスを乗せるとホバー効果、クリックで拡大モーダル表示

## 技術的改善点
### オリジナルKG Searchからの継承
- **2段階検索**: エンティティ収集 → SPARQL詳細取得
- **VALUES句**: 効率的なSPARQLクエリパターン  
- **テーブル表示**: QID、ラベル、詳細の3列構造
- **関連度順序**: Wikimedia API検索順序を維持（ORDER BYなし）
- **検索最適化**: type=item、strictlanguage=false設定

### フロントエンド改良
- **Googleライク**: 洗練されたUI/UX
- **日本語優先**: wikibase:labelサービス活用
- **インライン展開**: モーダルからテーブル内展開に変更
- **レスポンシブ**: モバイル対応

## デプロイメント
- **プラットフォーム**: Cloudflare Pages対応
- **ステータス**: ✅ 開発環境で動作中
- **技術スタック**: Hono + TypeScript + TailwindCSS + Vite
- **最終更新**: 2025-09-29

## 未実装機能
- Cloudflare Pages本番デプロイ
- GitHub リポジトリ連携
- 検索履歴機能
- お気に入り機能

## 推奨する次のステップ
1. **GitHub連携**: GitHubリポジトリ作成と連携設定
2. **本番デプロイ**: Cloudflare Pagesへの本番デプロイ
3. **機能拡張**: 検索履歴、お気に入り、高度フィルター
4. **パフォーマンス**: キャッシュ機能の追加
5. **多言語対応**: より多くの言語サポート

## 開発環境での実行
```bash
npm run build
pm2 start ecosystem.config.cjs
npm run test
```

## 特記事項
- 本プロジェクトはオリジナルKGSearchの手法を踏襲しつつ、フロントエンドとデータ表示部分を大幅に改良した版です
- WikidataのSPARQLエンドポイントを使用しているため、外部API依存があります
- 完全にステートレスな設計で、Cloudflare Workersに最適化されています